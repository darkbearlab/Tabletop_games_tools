<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Spotlight FX V5</title>
    <style>
        /* åŸºç¤è¨­å®š */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: #000000;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
            display: flex;
            justify-content: center;
            align-items: center;
            /* é—œéµï¼šç¢ºä¿èƒŒæ™¯æ¼¸å±¤å¹³æ»‘éæ¸¡ï¼Œé¿å…é–ƒçˆæ„Ÿ */
            transition: background-color 0.1s, background-image 0.1s;
        }

        /* ç‹€æ…‹æç¤ºå­— */
        #statusText {
            color: #666;
            font-size: 20px;
            pointer-events: none;
            text-align: center;
            opacity: 1;
            transition: opacity 0.2s;
            z-index: 1;
            text-shadow: 0 1px 2px rgba(0,0,0,0.8);
        }

        /* ç¨ç«‹é–‹é—œéˆ• (å³ä¸Šè§’) */
        #menuToggle {
            position: absolute;
            top: 20px; right: 20px;
            font-size: 30px; color: white;
            opacity: 0.3; z-index: 200; cursor: pointer;
            padding: 10px; transition: opacity 0.3s;
        }
        #menuToggle:active { opacity: 1; }

        /* æ§åˆ¶é¢æ¿ */
        #controls {
            position: absolute;
            background: rgba(20, 20, 20, 0.95);
            backdrop-filter: blur(10px);
            padding: 25px;
            border-radius: 16px;
            text-align: center;
            color: white;
            z-index: 100;
            min-width: 280px; /* ç¨å¾®åŠ å¯¬ */
            box-shadow: 0 4px 30px rgba(0,0,0,0.8);
            border: 1px solid #333;
            transition: transform 0.2s, opacity 0.2s;
        }
        .hidden { opacity: 0; pointer-events: none; transform: scale(0.95); }

        /* ä»‹é¢å…ƒä»¶ */
        .control-group { margin-bottom: 18px; text-align: left; }
        label { display: block; margin-bottom: 8px; font-size: 14px; color: #bbb; }
        select, input[type="color"], input[type="range"], #fsBtn { width: 100%; border-radius: 8px; }
        select { padding: 10px; border: 1px solid #444; background: #222; color: white; outline: none; }
        input[type="color"] { height: 45px; border: none; padding: 0; background: none; cursor: pointer; }
        input[type="range"] { accent-color: #007AFF; cursor: pointer; }
        .d-none { display: none; }
        
        #fsBtn { padding: 12px; background: #007AFF; border: none; color: white; font-weight: bold; font-size: 16px; }
        .val-display { float: right; color: #007AFF; font-weight: bold;}
    </style>
</head>
<body>

    <div id="menuToggle">âš™ï¸</div>
    <div id="statusText">æº–å‚™å°±ç·’</div>

    <div id="controls">
        <div class="control-group">
            <label>1. å…‰è‰²è¨­å®š</label>
            <input type="color" id="colorPicker" value="#FFFFFF">
        </div>

        <div class="control-group">
            <label>2. èšå…‰ç¯„åœ: <span id="spotSizeVal" class="val-display">100%</span></label>
            <input type="range" id="spotSizeRange" min="1" max="100" value="100">
        </div>

        <div class="control-group">
            <label>3. è§¸ç™¼æ¨¡å¼</label>
            <select id="modeSelect">
                <option value="steady">ğŸ’¡ å¸¸äº® (Steady)</option>
                <option value="hold" selected>ğŸ‘† æŒ‰å£“ç¬é–‹ (Hold)</option>
                <option value="strobe_hold">âš¡ æŒ‰å£“çˆ†é–ƒ (Strobe Hold)</option>
                <option value="strobe_toggle">â¯ï¸ é–‹é—œçˆ†é–ƒ (Strobe Toggle)</option>
            </select>
        </div>

        <div class="control-group d-none" id="strobeGroup">
            <label>é–ƒçˆé »ç‡: <span id="speedVal" class="val-display">12 Hz</span></label>
            <input type="range" id="freqRange" min="1" max="40" value="12">
        </div>

        <div class="control-group" style="margin-top: 25px;">
            <button id="fsBtn">å…¨è¢å¹• & éš±è—é¸å–®</button>
        </div>
    </div>

    <script>
        const body = document.body;
        const controls = document.getElementById('controls');
        const menuToggle = document.getElementById('menuToggle');
        const statusText = document.getElementById('statusText');
        // Inputs
        const colorPicker = document.getElementById('colorPicker');
        const spotSizeRange = document.getElementById('spotSizeRange');
        const spotSizeVal = document.getElementById('spotSizeVal');
        const modeSelect = document.getElementById('modeSelect');
        const strobeGroup = document.getElementById('strobeGroup');
        const freqRange = document.getElementById('freqRange');
        const speedVal = document.getElementById('speedVal');
        const fsBtn = document.getElementById('fsBtn');

        let currentMode = 'hold';
        let userColor = colorPicker.value;
        let spotSize = spotSizeRange.value;
        let strobeInterval = null;
        let isStrobeOn = false;
        let isToggledOn = false;
        let wakeLock = null;

        // --- åˆå§‹åŒ– ---
        updateUI();

        // --- æ ¸å¿ƒï¼šé–‹ç‡ˆèˆ‡é—œç‡ˆå‡½æ•¸ (V5é‡é») ---
        function turnLightOn() {
            statusText.style.opacity = 0;
            
            // å¦‚æœæ˜¯ 100%ï¼Œä½¿ç”¨ç´”è‰²èƒŒæ™¯æ•ˆèƒ½è¼ƒå¥½ï¼Œä¸”ç¢ºä¿ç„¡æ­»è§’
            if (spotSize >= 100) {
                 body.style.backgroundImage = 'none';
                 body.style.backgroundColor = userColor;
            } else {
                 // ä½¿ç”¨ CSS å¾‘å‘æ¼¸å±¤è£½ä½œèšå…‰ç‡ˆæ•ˆæœ
                 // closest-side ç¢ºä¿åœ“å½¢ä¸æœƒè¶…å‡ºè¢å¹•çŸ­é‚Š
                 // ä½¿ç”¨å…©å€‹è‰²æ¨™é» (size% å’Œ size.1%) ä¾†è£½é€ éŠ³åˆ©é‚Šç·£
                 body.style.backgroundColor = '#000000'; // ç¢ºä¿åº•è‰²æ˜¯é»‘çš„
                 body.style.backgroundImage = `radial-gradient(circle closest-side, ${userColor} ${spotSize}%, #000000 ${spotSize + 0.1}%)`;
            }
        }

        function turnLightOff() {
            statusText.style.opacity = 1;
            body.style.backgroundImage = 'none';
            body.style.backgroundColor = '#000000';
        }

        // --- äº‹ä»¶ç›£è½ ---

        // ä»‹é¢é–‹é—œ
        menuToggle.addEventListener('click', (e) => { e.stopPropagation(); controls.classList.toggle('hidden'); });
        fsBtn.addEventListener('click', (e) => { e.stopPropagation(); toggleFullScreen(); controls.classList.add('hidden'); requestWakeLock(); });

        // è¨­å®šå€¼è®Šæ›´
        colorPicker.addEventListener('input', (e) => {
            userColor = e.target.value;
            if (currentMode === 'steady') turnLightOn();
        });

        spotSizeRange.addEventListener('input', (e) => {
            spotSize = parseInt(e.target.value);
            spotSizeVal.innerText = spotSize + '%';
            // å¦‚æœç›®å‰æ˜¯äº®è‘—çš„ç‹€æ…‹ (å¸¸äº®æˆ–é–‹é—œæ¨¡å¼é–‹å•Ÿä¸­)ï¼Œå³æ™‚æ›´æ–°å…‰åœˆå¤§å°
            if (currentMode === 'steady' || (currentMode === 'strobe_toggle' && isToggledOn)) {
                turnLightOn();
            }
        });

        modeSelect.addEventListener('change', (e) => { currentMode = e.target.value; resetState(); updateUI(); });
        freqRange.addEventListener('input', (e) => { speedVal.innerText = e.target.value + ' Hz'; if (strobeInterval) startStrobe(); });

        // è§¸æ§æ“ä½œé‚è¼¯
        body.addEventListener('pointerdown', (e) => {
            if (controls.contains(e.target) || e.target === menuToggle) return;
            if (currentMode === 'hold') turnLightOn();
            else if (currentMode === 'strobe_hold') startStrobe();
        });

        const endAction = () => {
            if (currentMode === 'hold') turnLightOff();
            else if (currentMode === 'strobe_hold') stopStrobe();
        };
        body.addEventListener('pointerup', endAction);
        body.addEventListener('pointerleave', endAction);
        body.addEventListener('pointercancel', endAction);

        body.addEventListener('click', (e) => {
            if (controls.contains(e.target) || e.target === menuToggle) return;
            if (currentMode === 'strobe_toggle') {
                isToggledOn = !isToggledOn;
                if (isToggledOn) { startStrobe(); statusText.style.opacity = 0; } 
                else { stopStrobe(); }
            }
        });

        // --- è¼”åŠ©å‡½æ•¸ ---
        function updateUI() {
            currentMode.includes('strobe') ? strobeGroup.classList.remove('d-none') : strobeGroup.classList.add('d-none');
            switch(currentMode) {
                case 'steady': statusText.innerText = "å¸¸äº®æ¨¡å¼"; break;
                case 'hold': statusText.innerText = "æŒ‰å£“ç¬é–‹æ¨¡å¼"; break;
                case 'strobe_hold': statusText.innerText = "æŒ‰å£“çˆ†é–ƒæ¨¡å¼"; break;
                case 'strobe_toggle': statusText.innerText = "é»æ“Šé–‹é—œçˆ†é–ƒ"; break;
            }
            if (currentMode === 'steady') turnLightOn(); else turnLightOff();
        }

        function resetState() {
            stopStrobe(); isToggledOn = false;
            if (currentMode === 'steady') turnLightOn(); else turnLightOff();
        }

        function startStrobe() {
            if (strobeInterval) clearInterval(strobeInterval);
            const freq = parseInt(freqRange.value);
            strobeInterval = setInterval(() => {
                isStrobeOn = !isStrobeOn;
                isStrobeOn ? turnLightOn() : turnLightOff();
            }, 1000 / freq / 2);
        }

        function stopStrobe() {
            if (strobeInterval) clearInterval(strobeInterval); strobeInterval = null; turnLightOff();
        }

        async function toggleFullScreen() { try { await document.documentElement.requestFullscreen(); } catch(e) {} }
        async function requestWakeLock() { try { if ('wakeLock' in navigator) wakeLock = await navigator.wakeLock.request('screen'); } catch (err) {} }
    </script>
</body>
</html>

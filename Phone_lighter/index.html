<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Spotlight FX V6 (Position)</title>
    <style>
        /* åŸºç¤è¨­å®š */
        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            background-color: #000000; overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            user-select: none; -webkit-user-select: none; touch-action: manipulation;
            display: flex; justify-content: center; align-items: center;
            transition: background-color 0.1s; /* ç§»é™¤ image transition ä»¥å„ªåŒ–ä½ç§»æ•ˆèƒ½ */
        }

        /* ç‹€æ…‹æç¤ºå­— */
        #statusText {
            color: #666; font-size: 20px; pointer-events: none;
            text-align: center; opacity: 1; transition: opacity 0.2s; z-index: 1;
            text-shadow: 0 1px 2px rgba(0,0,0,0.8);
        }

        /* ç¨ç«‹é–‹é—œéˆ• */
        #menuToggle {
            position: absolute; top: 20px; right: 20px;
            font-size: 30px; color: white; opacity: 0.3; z-index: 200;
            cursor: pointer; padding: 10px; transition: opacity 0.3s;
        }
        #menuToggle:active { opacity: 1; }

        /* æ§åˆ¶é¢æ¿ */
        #controls {
            position: absolute;
            background: rgba(20, 20, 20, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 16px;
            text-align: center;
            color: white;
            z-index: 100;
            min-width: 300px;
            box-shadow: 0 4px 30px rgba(0,0,0,0.8);
            border: 1px solid #333;
            max-height: 90vh;
            overflow-y: auto; /* é˜²æ­¢æ‰‹æ©Ÿæ©«æ”¾æ™‚é¸å–®å¤ªé•· */
        }
        .hidden { opacity: 0; pointer-events: none; transform: scale(0.95); }

        /* ä»‹é¢å…ƒä»¶ */
        .control-group { margin-bottom: 15px; text-align: left; }
        label { display: block; margin-bottom: 5px; font-size: 13px; color: #bbb; }
        
        /* é›™æ¬„æ’ç‰ˆç”¨æ–¼ä½ç½®èª¿æ•´ */
        .row { display: flex; gap: 10px; }
        .col { flex: 1; }

        select, input[type="color"], input[type="range"], #fsBtn { width: 100%; border-radius: 8px; }
        select { padding: 8px; border: 1px solid #444; background: #222; color: white; outline: none; }
        input[type="color"] { height: 40px; border: none; padding: 0; background: none; cursor: pointer; }
        input[type="range"] { accent-color: #007AFF; cursor: pointer; height: 5px; margin-top:5px;}
        .d-none { display: none; }
        
        #fsBtn { padding: 12px; background: #007AFF; border: none; color: white; font-weight: bold; font-size: 16px; margin-top: 10px;}
        .val-display { float: right; color: #007AFF; font-weight: bold; font-size: 13px;}
    </style>
</head>
<body>

    <div id="menuToggle">âš™ï¸</div>
    <div id="statusText">V6 è‡ªç”±ä½ç§»ç‰ˆ</div>

    <div id="controls">
        <div class="control-group">
            <label>1. å…‰è‰²è¨­å®š</label>
            <input type="color" id="colorPicker" value="#FFFFFF">
        </div>

        <div class="control-group">
            <label>2. å…‰åœˆå¤§å°: <span id="spotSizeVal" class="val-display">50%</span></label>
            <input type="range" id="spotSizeRange" min="1" max="150" value="50">
        </div>

        <div class="control-group row">
            <div class="col">
                <label>æ°´å¹³ä½ç½® (X)</label>
                <input type="range" id="posXRange" min="0" max="100" value="50">
            </div>
            <div class="col">
                <label>å‚ç›´ä½ç½® (Y)</label>
                <input type="range" id="posYRange" min="0" max="100" value="50">
            </div>
        </div>

        <div class="control-group">
            <label>3. è§¸ç™¼æ¨¡å¼</label>
            <select id="modeSelect">
                <option value="steady">ğŸ’¡ å¸¸äº® (Steady)</option>
                <option value="hold" selected>ğŸ‘† æŒ‰å£“ç¬é–‹ (Hold)</option>
                <option value="strobe_hold">âš¡ æŒ‰å£“çˆ†é–ƒ (Hold)</option>
                <option value="strobe_toggle">â¯ï¸ é–‹é—œçˆ†é–ƒ (Toggle)</option>
            </select>
        </div>

        <div class="control-group d-none" id="strobeGroup">
            <label>é »ç‡: <span id="speedVal" class="val-display">12 Hz</span></label>
            <input type="range" id="freqRange" min="1" max="40" value="12">
        </div>

        <div class="control-group">
            <button id="fsBtn">å…¨è¢å¹• & éš±è—é¸å–®</button>
        </div>
        
        <div style="text-align: center; margin-top: 5px;">
            <a href="#" id="resetPos" style="color: #666; font-size: 12px; text-decoration: none;">[é‡ç½®ä½ç½®]</a>
        </div>
    </div>

    <script>
        // DOM Elements
        const body = document.body;
        const controls = document.getElementById('controls');
        const menuToggle = document.getElementById('menuToggle');
        const statusText = document.getElementById('statusText');
        const resetPosBtn = document.getElementById('resetPos');
        
        const colorPicker = document.getElementById('colorPicker');
        const spotSizeRange = document.getElementById('spotSizeRange');
        const spotSizeVal = document.getElementById('spotSizeVal');
        const posXRange = document.getElementById('posXRange');
        const posYRange = document.getElementById('posYRange');
        
        const modeSelect = document.getElementById('modeSelect');
        const strobeGroup = document.getElementById('strobeGroup');
        const freqRange = document.getElementById('freqRange');
        const speedVal = document.getElementById('speedVal');
        const fsBtn = document.getElementById('fsBtn');

        // State Variables
        let currentMode = 'hold';
        let userColor = colorPicker.value;
        let spotSize = parseInt(spotSizeRange.value); // Unit: vmax
        let posX = 50; // Percentage
        let posY = 50; // Percentage
        
        let strobeInterval = null;
        let isStrobeOn = false;
        let isToggledOn = false;
        let wakeLock = null;

        // Init
        updateUI();

        // --- Core: Lighting Logic ---
        function turnLightOn() {
            statusText.style.opacity = 0;
            
            // ä½¿ç”¨ vmax å–®ä½ç¢ºä¿åœ“å½¢ä¸è®Šå½¢
            // X% Y% æ§åˆ¶ä¸­å¿ƒé»
            // radial-gradient(circle [radius] at [position X] [position Y], [start color], [end color])
            const gradient = `radial-gradient(circle ${spotSize}vmax at ${posX}% ${posY}%, ${userColor} 0%, ${userColor} 99%, #000000 100%)`;
            
            body.style.backgroundColor = '#000000';
            body.style.backgroundImage = gradient;
        }

        function turnLightOff() {
            statusText.style.opacity = 1;
            body.style.backgroundImage = 'none';
            body.style.backgroundColor = '#000000';
        }

        function refreshLightIfActive() {
            if (currentMode === 'steady' || (currentMode === 'strobe_toggle' && isToggledOn)) {
                turnLightOn();
            } else if (currentMode === 'hold' && body.matches(':active')) {
                // ç‰¹æ®Šæƒ…æ³ï¼šå¦‚æœåœ¨ Hold æ¨¡å¼ä¸‹èª¿æ•´ä¸”æ‰‹æŒ‡æ­£æŒ‰è‘—èƒŒæ™¯(æ»‘é¼ æ¨¡æ“¬æ™‚è¼ƒå¸¸è¦‹)
                turnLightOn();
            }
        }

        // --- Event Listeners ---

        menuToggle.addEventListener('click', (e) => { e.stopPropagation(); controls.classList.toggle('hidden'); });
        fsBtn.addEventListener('click', (e) => { e.stopPropagation(); toggleFullScreen(); controls.classList.add('hidden'); requestWakeLock(); });

        // æ•¸å€¼èª¿æ•´
        colorPicker.addEventListener('input', (e) => { userColor = e.target.value; refreshLightIfActive(); });
        
        spotSizeRange.addEventListener('input', (e) => { 
            spotSize = parseInt(e.target.value); 
            spotSizeVal.innerText = spotSize + '%'; 
            refreshLightIfActive(); 
        });

        // ä½ç½®èª¿æ•´
        posXRange.addEventListener('input', (e) => { posX = e.target.value; refreshLightIfActive(); });
        posYRange.addEventListener('input', (e) => { posY = e.target.value; refreshLightIfActive(); });
        
        // é‡ç½®ä½ç½®
        resetPosBtn.addEventListener('click', (e) => {
            e.preventDefault(); e.stopPropagation();
            posX = 50; posY = 50;
            posXRange.value = 50; posYRange.value = 50;
            refreshLightIfActive();
        });

        modeSelect.addEventListener('change', (e) => { currentMode = e.target.value; resetState(); updateUI(); });
        freqRange.addEventListener('input', (e) => { speedVal.innerText = e.target.value + ' Hz'; if (strobeInterval) startStrobe(); });

        // è§¸æ§é‚è¼¯
        body.addEventListener('pointerdown', (e) => {
            if (controls.contains(e.target) || e.target === menuToggle) return;
            if (currentMode === 'hold') turnLightOn();
            else if (currentMode === 'strobe_hold') startStrobe();
        });

        const endAction = () => {
            if (currentMode === 'hold') turnLightOff();
            else if (currentMode === 'strobe_hold') stopStrobe();
        };
        body.addEventListener('pointerup', endAction);
        body.addEventListener('pointerleave', endAction);
        body.addEventListener('pointercancel', endAction);

        body.addEventListener('click', (e) => {
            if (controls.contains(e.target) || e.target === menuToggle) return;
            if (currentMode === 'strobe_toggle') {
                isToggledOn = !isToggledOn;
                if (isToggledOn) { startStrobe(); statusText.style.opacity = 0; } 
                else { stopStrobe(); }
            }
        });

        // Helpers
        function updateUI() {
            currentMode.includes('strobe') ? strobeGroup.classList.remove('d-none') : strobeGroup.classList.add('d-none');
            // æ›´æ–°ç‹€æ…‹æ–‡å­—
            const map = {
                'steady': 'å¸¸äº®æ¨¡å¼ (èª¿æ•´ä½ç½®é è¦½)',
                'hold': 'æŒ‰å£“ç¬é–‹',
                'strobe_hold': 'æŒ‰å£“çˆ†é–ƒ',
                'strobe_toggle': 'é»æ“Šé–‹é—œçˆ†é–ƒ'
            };
            statusText.innerText = map[currentMode];
            if (currentMode === 'steady') turnLightOn(); else turnLightOff();
        }

        function resetState() {
            stopStrobe(); isToggledOn = false;
            if (currentMode === 'steady') turnLightOn(); else turnLightOff();
        }

        function startStrobe() {
            if (strobeInterval) clearInterval(strobeInterval);
            const freq = parseInt(freqRange.value);
            strobeInterval = setInterval(() => {
                isStrobeOn = !isStrobeOn;
                isStrobeOn ? turnLightOn() : turnLightOff();
            }, 1000 / freq / 2);
        }

        function stopStrobe() {
            if (strobeInterval) clearInterval(strobeInterval); strobeInterval = null; turnLightOff();
        }

        async function toggleFullScreen() { try { await document.documentElement.requestFullscreen(); } catch(e) {} }
        async function requestWakeLock() { try { if ('wakeLock' in navigator) wakeLock = await navigator.wakeLock.request('screen'); } catch (err) {} }
    </script>
</body>
</html>

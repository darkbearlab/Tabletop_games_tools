<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Pro Screen FX V4</title>
    <style>
        /* åŸºç¤è¨­å®š */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: #000000;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* ç‹€æ…‹æç¤ºå­— */
        #statusText {
            color: #444;
            font-size: 20px;
            pointer-events: none;
            text-align: center;
            opacity: 1;
            transition: opacity 0.2s;
            z-index: 1;
        }

        /* ç¨ç«‹çš„é¸å–®é–‹é—œæŒ‰éˆ• (å³ä¸Šè§’) */
        #menuToggle {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 30px;
            color: white;
            opacity: 0.3; /* å¹³å¸¸å¾ˆæ·¡ï¼Œä¸æ¶æˆ² */
            z-index: 200; /* æœ€ä¸Šå±¤ */
            cursor: pointer;
            padding: 10px; /* å¢åŠ é»æ“Šç¯„åœ */
            transition: opacity 0.3s;
        }
        #menuToggle:active { opacity: 1; }

        /* æ§åˆ¶é¢æ¿ */
        #controls {
            position: absolute;
            background: rgba(20, 20, 20, 0.95);
            backdrop-filter: blur(10px);
            padding: 25px;
            border-radius: 16px;
            text-align: center;
            color: white;
            z-index: 100;
            min-width: 260px;
            box-shadow: 0 4px 30px rgba(0,0,0,0.8);
            border: 1px solid #333;
            transition: transform 0.2s, opacity 0.2s;
        }

        /* éš±è—é¢æ¿æ™‚çš„æ•ˆæœ */
        .hidden { 
            opacity: 0; 
            pointer-events: none; 
            transform: scale(0.95);
        }

        /* ä»‹é¢å…ƒä»¶æ¨£å¼ */
        .control-group { margin-bottom: 18px; }
        label { display: block; margin-bottom: 8px; font-size: 14px; color: #bbb; }
        
        select {
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #444;
            background: #222;
            color: white;
            font-size: 16px;
            width: 100%;
            outline: none;
        }

        input[type="color"] {
            border: none;
            width: 100%;
            height: 50px;
            padding: 0;
            background: none;
            cursor: pointer;
            border-radius: 8px;
        }

        input[type="range"] { width: 100%; accent-color: #ff3b30; }
        .d-none { display: none; }
        
        #fsBtn {
            width: 100%;
            padding: 12px;
            background: #007AFF;
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            font-size: 16px;
        }
    </style>
</head>
<body>

    <div id="menuToggle">âš™ï¸</div>

    <div id="statusText">é¸æ“‡æ¨¡å¼å¾Œéš±è—é¸å–®</div>

    <div id="controls">
        <div class="control-group">
            <label>1. å…‰è‰²è¨­å®š</label>
            <input type="color" id="colorPicker" value="#FFA500"> </div>

        <div class="control-group">
            <label>2. è§¸ç™¼æ¨¡å¼</label>
            <select id="modeSelect">
                <option value="steady">ğŸ’¡ å¸¸äº® (Steady)</option>
                <option value="hold" selected>ğŸ‘† æŒ‰å£“ç¬é–‹ (Hold)</option>
                <option value="strobe_hold">âš¡ æŒ‰å£“çˆ†é–ƒ (Strobe Hold)</option>
                <option value="strobe_toggle">â¯ï¸ é–‹é—œçˆ†é–ƒ (Strobe Toggle)</option>
            </select>
        </div>

        <div class="control-group d-none" id="strobeGroup">
            <label>é »ç‡: <span id="speedVal">12</span> Hz</label>
            <input type="range" id="freqRange" min="1" max="40" value="12">
        </div>

        <div class="control-group">
            <button id="fsBtn">å…¨è¢å¹• & éš±è—é¸å–®</button>
        </div>
        
        <p style="font-size:12px; color:#666;">é»æ“Šå³ä¸Šè§’ âš™ï¸ åˆ‡æ›é¸å–®</p>
    </div>

    <script>
        const body = document.body;
        const controls = document.getElementById('controls');
        const menuToggle = document.getElementById('menuToggle');
        const statusText = document.getElementById('statusText');
        const colorPicker = document.getElementById('colorPicker');
        const modeSelect = document.getElementById('modeSelect');
        const strobeGroup = document.getElementById('strobeGroup');
        const freqRange = document.getElementById('freqRange');
        const speedVal = document.getElementById('speedVal');
        const fsBtn = document.getElementById('fsBtn');

        let currentMode = 'hold'; // é è¨­æ”¹ç‚º Hold æ–¹ä¾¿æ¸¬è©¦
        let userColor = colorPicker.value;
        let strobeInterval = null;
        let isStrobeOn = false;
        let isToggledOn = false;
        let wakeLock = null;

        // --- åˆå§‹åŒ– ---
        updateUI();

        // --- é¸å–®é–‹é—œé‚è¼¯ (æœ€é‡è¦æ”¹å‹•) ---
        menuToggle.addEventListener('click', (e) => {
            e.stopPropagation(); // é˜²æ­¢é»æ“ŠæŒ‰éˆ•æ™‚è§¸ç™¼é–ƒå…‰
            controls.classList.toggle('hidden');
        });

        // --- å…¨è¢å¹•æŒ‰éˆ• ---
        fsBtn.addEventListener('click', async (e) => {
            e.stopPropagation();
            toggleFullScreen();
            controls.classList.add('hidden'); // æŒ‰ä¸‹æŒ‰éˆ•ä¸€å®šéš±è—
            requestWakeLock();
        });

        // --- æ ¸å¿ƒæ“ä½œé‚è¼¯ ---
        
        // æŒ‰ä¸‹
        body.addEventListener('pointerdown', (e) => {
            // å¦‚æœé»åˆ°é¢æ¿æˆ–è¨­å®šéˆ•ï¼Œä¸å‹•ä½œ
            if (controls.contains(e.target) || e.target === menuToggle) return;

            if (currentMode === 'hold') {
                body.style.backgroundColor = userColor;
                statusText.style.opacity = 0;
            } 
            else if (currentMode === 'strobe_hold') {
                startStrobe();
                statusText.style.opacity = 0;
            }
        });

        // æ”¾é–‹ / é›¢é–‹
        const endAction = () => {
            if (currentMode === 'hold') {
                body.style.backgroundColor = '#000000';
                statusText.style.opacity = 1;
            }
            else if (currentMode === 'strobe_hold') {
                stopStrobe();
                statusText.style.opacity = 1;
            }
        };
        body.addEventListener('pointerup', endAction);
        body.addEventListener('pointerleave', endAction);
        body.addEventListener('pointercancel', endAction);

        // é»æ“Š (Toggleæ¨¡å¼ç”¨)
        body.addEventListener('click', (e) => {
            if (controls.contains(e.target) || e.target === menuToggle) return;

            if (currentMode === 'strobe_toggle') {
                isToggledOn = !isToggledOn;
                if (isToggledOn) {
                    startStrobe();
                    statusText.style.opacity = 0;
                    statusText.innerText = "";
                } else {
                    stopStrobe();
                    statusText.innerText = "é»æ“Šè¢å¹•é–‹å§‹/æš«åœ";
                    statusText.style.opacity = 1;
                }
            }
        });

        // --- è¨­å®šå€¼è®Šæ›´ ---
        colorPicker.addEventListener('input', (e) => {
            userColor = e.target.value;
            if (currentMode === 'steady') body.style.backgroundColor = userColor;
        });

        modeSelect.addEventListener('change', (e) => {
            currentMode = e.target.value;
            resetState();
            updateUI();
        });

        freqRange.addEventListener('input', (e) => {
            speedVal.innerText = e.target.value;
            if (strobeInterval) startStrobe();
        });

        // --- è¼”åŠ©å‡½æ•¸ ---
        function updateUI() {
            if (currentMode.includes('strobe')) {
                strobeGroup.classList.remove('d-none');
            } else {
                strobeGroup.classList.add('d-none');
            }

            switch(currentMode) {
                case 'steady': statusText.innerText = ""; break;
                case 'hold': statusText.innerText = "æŒ‰å£“ç¬é–‹ (ç‰¹æ•ˆç”¨)"; break;
                case 'strobe_hold': statusText.innerText = "æŒ‰å£“çˆ†é–ƒ"; break;
                case 'strobe_toggle': statusText.innerText = "é»æ“Šè¢å¹•é–‹å§‹/æš«åœ"; break;
            }

            if (currentMode === 'steady') {
                body.style.backgroundColor = userColor;
            } else {
                body.style.backgroundColor = '#000000';
            }
        }

        function resetState() {
            stopStrobe();
            isToggledOn = false;
            statusText.style.opacity = 1;
            body.style.backgroundColor = (currentMode === 'steady') ? userColor : '#000000';
        }

        function startStrobe() {
            if (strobeInterval) clearInterval(strobeInterval);
            const freq = parseInt(freqRange.value);
            const ms = 1000 / freq / 2;
            
            strobeInterval = setInterval(() => {
                isStrobeOn = !isStrobeOn;
                body.style.backgroundColor = isStrobeOn ? userColor : '#000000';
            }, ms);
        }

        function stopStrobe() {
            if (strobeInterval) clearInterval(strobeInterval);
            strobeInterval = null;
            body.style.backgroundColor = '#000000';
        }

        async function toggleFullScreen() {
            if (!document.fullscreenElement) {
                try { await document.documentElement.requestFullscreen(); } catch(e) {}
            }
        }

        async function requestWakeLock() {
            try { if ('wakeLock' in navigator) wakeLock = await navigator.wakeLock.request('screen'); } catch (err) {}
        }
    </script>
</body>
</html>
